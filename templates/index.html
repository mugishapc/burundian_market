{% extends "base.html" %}
{% block title %}Home{% endblock %}

{% block content %}
<!-- Mobile-optimized hero section -->
<div class="hero-section bg-primary text-white py-4 py-md-5 mb-4 mb-md-5">
    <div class="container text-center">
        <h1 class="display-5 display-md-4 mb-2 mb-md-3">Welcome to Burundian Market</h1>
        <p class="lead mb-3 mb-md-4">Buy and sell products locally in Burundi</p>
        <a href="{{ url_for('register') }}" class="btn btn-light btn-lg">Get Started</a>
    </div>
</div>

<div class="container">
    <h2 class="mb-3 mb-md-4 text-center text-md-start">Featured Products</h2>
    <div class="row g-3 g-md-4">
        {% for product in products %}
        <div class="col-6 col-md-4 col-lg-3">
            <div class="card h-100 product-card">
                {% if product.image_data %}
                    <img src="{{ url_for('get_product_image', product_id=product.id) }}" 
                         class="card-img-top product-image" 
                         alt="{{ product.title }}"
                         loading="lazy"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                {% endif %}
                <div class="no-image" style="{% if product.image_data %}display: none;{% else %}display: flex;{% endif %}">
                    <div class="text-center">
                        <i class="fas fa-camera fa-lg text-muted mb-2"></i>
                        <p class="text-muted mb-0 small">No Image</p>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title fs-6">{{ product.title }}</h5>
                    <p class="card-text text-success fw-bold mt-auto">{{ product.price|format_currency }} BIF</p>
                    <a href="{{ url_for('product_detail', product_id=product.id) }}" class="btn btn-primary btn-sm">View Details</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Mobile-optimized registration CTA -->
<div class="container mt-4 mt-md-5">
    <div class="row justify-content-center">
        <div class="col-12 col-md-10 col-lg-8 text-center">
            <div class="card border-warning">
                <div class="card-body py-3 py-md-4">
                    <h3 class="card-title h5 h4-md text-warning mb-2 mb-md-3">Join Our Marketplace Today!</h3>
                    <p class="mb-2" style="color: #dc3545; font-weight: bold; font-size: 0.9rem;">
                        TO SEE MORE PRODUCTS, PLEASE REGISTER AND LOGIN AS A BUYER.
                    </p>
                    <p class="mb-3 mb-md-4" style="color: #dc3545; font-weight: bold; font-size: 0.9rem;">
                        TO SHOW THE WORLD WHAT YOU DO, PLEASE REGISTER AND LOGIN AS A SELLER.
                    </p>
                    <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
                        <a href="{{ url_for('register') }}" class="btn btn-success btn-sm btn-md-lg">
                            <i class="fas fa-user-plus me-1"></i> Register Now
                        </a>
                        <a href="{{ url_for('login') }}" class="btn btn-outline-primary btn-sm btn-md-lg">
                            <i class="fas fa-sign-in-alt me-1"></i> Login
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Mobile-optimized home page styles */
.product-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    border: 1px solid #dee2e6;
}

.product-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.hero-section {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
    border-radius: 0 0 10px 10px;
}

/* Mobile-specific adjustments */
@media (max-width: 576px) {
    .hero-section h1 {
        font-size: 1.5rem !important;
    }
    
    .hero-section .lead {
        font-size: 0.9rem;
    }
    
    .card-title {
        font-size: 0.9rem;
        line-height: 1.3;
    }
    
    .btn-md-lg {
        padding: 10px 20px;
        font-size: 0.9rem;
    }
}

/* Better card layout on very small screens */
@media (max-width: 375px) {
    .col-6 {
        flex: 0 0 100%;
        max-width: 100%;
    }
}

/* Improved image loading for mobile */
.product-image {
    background-color: #f8f9fa;
    transition: opacity 0.3s ease;
}

.product-image.loading {
    opacity: 0.6;
}
</style>

<script>
// Mobile-optimized home page script
document.addEventListener('DOMContentLoaded', function() {
    console.log('Mobile-optimized home page loaded');
    
    // Mobile-optimized image handling
    const productImages = document.querySelectorAll('.product-card .product-image');
    
    productImages.forEach((img, index) => {
        if (img.src && img.src.includes('/product/image/')) {
            // Lazy loading for mobile
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.src.split('?')[0] + '?mobile_load=' + new Date().getTime();
                        observer.unobserve(img);
                    }
                });
            });
            
            observer.observe(img);
        }
    });

    // Mobile-optimized PropellerAds
    window.addEventListener('load', function() {
        console.log('Mobile home page fully loaded');
    });
    
    // Mobile touch improvements
    document.querySelectorAll('.product-card').forEach(card => {
        card.style.cursor = 'pointer';
        card.addEventListener('click', function(e) {
            if (!e.target.closest('a') && !e.target.closest('button')) {
                const link = this.querySelector('a.btn');
                if (link) {
                    link.click();
                }
            }
        });
    });
});
</script>
{% endblock %}